<!-- FAB Button -->
@if (!isOpen()) {
  <button class="chat-fab" aria-label="Open chat" (click)="open()">
    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/>
    </svg>
  </button>
}

<!-- Chat Panel -->
@if (isOpen()) {
  <div class="chat-panel">
    <!-- Header -->
    <div class="chat-header">
      <div class="chat-header__left">
        <div class="chat-header__avatar">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/>
            <path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/>
          </svg>
        </div>
        <div class="chat-header__text">
          <span class="chat-header__title">{{ brandName() }}</span>
          <span class="chat-header__subtitle">Typically replies instantly</span>
        </div>
      </div>
      <button class="chat-header__close" aria-label="Close chat" (click)="close()">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 6 6 18"/><path d="m6 6 12 12"/>
        </svg>
      </button>
    </div>

    <!-- Messages -->
    <div class="chat-messages" #messageThread>
      @for (message of messages(); track $index) {
        <lib-chat-message
          [sender]="message.sender"
          [content]="message.content"
          [timestamp]="message.timestamp"
        />
      }
      @if (isTyping()) {
        <lib-chat-typing-indicator />
      }
    </div>

    <!-- Input -->
    <div class="chat-input">
      <input
        type="text"
        class="chat-input__field"
        placeholder="Ask about our products..."
        [(ngModel)]="inputValue"
        (keydown.enter)="send()"
      />
      <button class="chat-input__send" aria-label="Send message" (click)="send()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/>
        </svg>
      </button>
    </div>
  </div>
}
